"use strict";var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}{var $=window.jQuery||window.$||window.optimizely&&window.optimizely.$,COLORS=["success","danger","warning","primary","info"],Esper=function(){function a(){if(_classCallCheck(this,a),$("#opt_container,#opt_styles,#opt_backdrop").remove(),$("head").append(a.stylesheet),this.$container=$("<div id='opt_container'/>").appendTo($("body")),this.$backdrop=$("<div id='opt_backdrop'/>").click(function(){this.$container.remove(),this.$backdrop.remove()}).appendTo($("body")),!window.optimizely)return this.$container.append("<h1>Error: Missing Optimizely.</h1>");if(!$)return this.$container.append("<h1>Error: Missing jQuery.</h1>");var b=!!window.optimizely.get,c=window.optimizely.data||{},d=window.optimizely.get&&window.optimizely.get("data")||{};this.state=c.state||{},this.audiences=c.audiences||{},this.variations=c.variations||{},this.experiments=c.experiments||{},this.segments=c.segments||{},this.visitor=c.visitor||{},this.accountId=d.accountId||window.optimizely.getAccountId(),this.launch(),$(window).resize(this.resize),this.resize()}return _createClass(a,[{key:"resize",value:function resize(){var a=$(window).width(),b=$(window).height();this.$container.css({height:b/1.25+"px",width:a/1.5+"px","margin-top":"-"+b/2.5+"px","margin-left":"-"+a/3+"px"})}},{key:"launch",value:function launch(){var a=this,b=$("\n        <div id='ooo_container' class='container'>\n          <section id='ooo_container_visitors' class='container'>\n            <div class='well'><br>\n              <h1 class='header center'>This Site: <b>"+window.location.host+"</b></h1>\n              <div id='account_stats' class='row'>\n                <p class='col-xs-3'>\n                  <u>Total Experiments</u><br><span>"+Object.keys(this.experiments).length+"</span></p>\n                <p class='col-xs-3'>\n                  <u>Approx. Library Size</u><br><span>"+(JSON.stringify(window.optimizely).length/1e3).toFixed()+" KB</span></p>\n                <p class='col-xs-3'>\n                  <u>Total Variations</u><br><span>"+Object.keys(this.variations).length+"</span></p>\n                <p class='col-xs-3'>\n                  <u>Account Owner</u><br><span>"+this.accountId+"</span></p>\n              </div>\n            </div><br>\n            <div id='ooo_filters' class='row center'>\n              <div class='btn-group' data-toggle='buttons'>\n                <span style='font-weight:bolder;font-size:16px;'>Experiment Status:&emsp;</span>\n                <button class='btn info btn-info' filter='all'>ALL EXPERIMENTS</button>\n                <button class='btn info btn-info' filter='live'>LIVE EXPERIMENTS</button>\n                <button class='btn info btn-info' filter='paused'>PAUSED EXPERIMENTS</button>\n              </div><br>\n              <div id='view_people' class='btn-group' data-toggle='button'>\n                <span style='font-weight:bolder;font-size:16px;'>Browse Visitor Criteria:&emsp;</span>\n                <button class='btn btn-warning' show='ooo_audiences' id='view_audiences'>AUDIENCES</button>\n                <button class='btn btn-warning' show='ooo_visitor_you' id='view_visitor_you'>YOUR SEGMENTS</button>\n                <button class='btn btn-warning' show='ooo_visitor_all' id='view_visitor_all'>ALL SEGMENTS</button>\n                <button class='btn btn-warning btn-lg' show='my_variants' id='show_my_variants'>MY EXPERIENCE</button>\n              </div>\n              <hr>\n              <section id='ooo_container_visitor' class='container'>\n                <div class='row-fluid'>\n                  <div style='display:none;' id='ooo_audiences' class='well blue col-xs-12'>\n                    <a class='closeme'>CLOSE</a> "+this.renderAudiences()+"\n                  </div>\n                  <div style='display:none;' id='ooo_visitor_you' class='well blue col-xs-12'>\n                    <a class='closeme'>CLOSE</a> "+this.renderYourSegments()+"\n                  </div>\n                  <div style='display:none;' id='ooo_visitor_all' class='well blue col-xs-12'>\n                    <a class='closeme'>CLOSE</a> "+this.renderAllSegments()+"\n                  </div>\n                  <div id='my_variants' class='center well alert alert-info' style='display:none'>\n                    <a class='closeme'>CLOSE</a> "+this.renderMyVariants()+"\n                  </div>\n                </div>\n              </section>\n\n            </div>\n            <div id='alert' class='center well alert alert-warning' style='display:none;'>\n              <a class='closeme'>CLOSE</a>\n            </div>\n          </section>\n          <section id='ooo_containerExperiments' class='container'>\n          </section>\n        </div>\n      ").appendTo(this.$container),c=b.find("#ooo_containerExperiments"),d=b.find("#alert");$.each(this.getExperimentId().reverse(),function(b,d){c.append(a.addExperiment(d))}),b.find(".closeme").click(function(){$(this).parent().hide(),b.find("#ooo_filters > div >  button, #ooo_filters > div > label").removeClass("active")}),b.find("[filter]").click(function(){b.find("[experiment_id]").hide();var a=$(this).attr("filter");b.find("#ooo_container_visitor > div > div").hide();var e=c.find("."+a+"Experiment").show();e.length?d.html("").css("display","none"):d.css("display","block").html("<h2> There are no "+("ooo"==a?"":a)+" experiments to show :(")}),b.find("#view_people button").click(function(){var a=$(this),c=a.attr("show"),d=b.find("#"+c),e=d.is(":visible");b.find("#ooo_container_visitor .well").hide(),d.css("display",e?"none":"block"),b.find("#ooo_filters > div >  button, #ooo_filters > div > label").removeClass("active")}),b.find("#show_my_variants").click(function(){var a=$(this),c=b.find(a.attr("show")),d=c.is(":visible");c.css("display",d?"none":"block"),b.find("#ooo_filters > div >  button, #ooo_filters > div > label").removeClass("active")})}},{key:"getExperimentId",value:function getExperimentId(a){return a?this.experiments[a]?this.experiments[a]:alert("Experiment #"+a+" not found."):Object.keys(this.experiments)}},{key:"getExperimentName",value:function getExperimentName(a){return!!this.isExperiment(a)&&this.experiments[a].name}},{key:"addExperiment",value:function addExperiment(a){var b=this.experiments[a]||{},c=b.variation_ids||{},d=Object.keys(c).length,e=~$.inArray(a,this.state.activeExperiments),f=(b.section_ids.length?"MVT ("+b.section_ids.length+" Elements)":"A/B/n")+" | "+d+" Variations",g=e?"<label style=\"font-size:100%;\" class=\"label label-success label-large show_variations\">LIVE</label>":"<label style=\"font-size:100%;\" class=\"label label-grey\">Not Running</label>",h=$("<div experiment_id=\""+a+"\" class=\"row "+(e?" liveExperiment":" pausedExperiment")+" allExperiment\">\n        <i class=\"icon-plus\"></i>\n         <h3><a class=\"experiment_name\">"+this.getExperimentName(a)+"</a></h3>&emsp;\n         <code class=\"show_variations\">Experiment ID: "+a+"</code>&emsp;\n         <code class=\"show_variations\">"+f+"</code>&emsp;\n         "+g+"&emsp;\n         "+(d?"<button class=\"show_variations btn btn-danger\">View Variations</button>":"")+" &emsp;\n         "+(b.manual?"<label class=\"label label-warning\">Manually Activated</label>":"")+"\n         "+(b.code?"&emsp;<button class=\"show_code btn btn-small btn-info\">View Script</button><pre class=\"pre-scrollable script_display\" style=\"display:none;\">"+this.htmlspecialchars(b.code)+"</pre>":"")+"\n         <section style=\"display:none;\" class=\"variation_section container\"></section>\n      </div>"),i=h.find(".variation_section").append(this.renderVariationsSection(a));return h.find(".show_variations").click(function(){i.toggle(),h.find("button.show_variations").text(i.is(":visible")?"Hide Variations":"View Variations")}),h.find(".show_code").click(function(){var a=$(this),b=a.parent().find("pre");b.toggle(),a.text(b.is(":visible")?"Hide Script":"View Script")}),h}},{key:"renderYourSegments",value:function renderYourSegments(){var a=this;if(!this.visitor.segments)return"<h2 class='center'><label class='badge badge-danger'>You are not part of any segments!</label></h2>";var b=this.visitor.segments,c=0,d="<h2>Here are the segments you are part of: </h2><br><br>";return $.each(b,function(b,e){a.segments[b]&&(d+="<label class='segment col-sm-5 label label-"+COLORS[c]+"'>"+a.segments[b].name+" = "+e+"</label>",c=3==c?0:c+1)}),d}},{key:"renderAllSegments",value:function renderAllSegments(){var a=this;if(!this.segments)return"<h2 class='center'><label class='badge badge-danger'>There are no segments created.</label></h2>";var b="<h2>Here are all segments being targeted towards on this site: </h2><hr>",c=0;return $.each(this.segments,function(d){b+="<label class='segment col-sm-5 label label-"+COLORS[c]+"'>"+a.segments[d].name+"</label>",c=3==c?0:c+1}),b}},{key:"renderMyVariants",value:function renderMyVariants(){var a=this,b=window.optimizely.variationNamesMap||{},c=0,d="<h2>Here are the tests and variations you are currently a part of!</h2>";return b&&Object.keys(b).length?($.each(b,function(b,e){d+="<label class='segment col-sm-12 label label-"+COLORS[c]+"' style='width:90%;left:5%;'>&emsp;"+a.experiments[b].name+" - &emsp;<code>"+e+"</code></label>",c=3==c?0:c+1}),d):"<h2 class='center'><label class='badge badge-danger'>You are not in any experiments! Shame...</label></h2>"}},{key:"renderAudiences",value:function renderAudiences(){if(!this.audiences)return"<h2 class='center'><label badge badge-danger'>There are no audiences created.</label></h2>";var a=0,b="<h2>Here are all audiences being observed in analytics on this site: </h2><hr>";return $.each(this.audiences,function(c,d){b+="<label class='segment col-sm-5 label label-"+COLORS[a]+"'>"+d.name+"</label>",a=3==a?0:a+1}),b}},{key:"renderVariationsSection",value:function renderVariationsSection(a){var b=this,c=this.experiments[a],d=$("<div/>");return $.each(c.variation_ids,function(c,e){var f=b.variations[e].name,g=b.variations[e].code,h=function(){var b=location.href;return b+=(b.split("?")[1]?"&":"?")+"optimizely_x"+a+"="+c,"<a href=\""+b+"\" class=\"pull-right btn btn-primary\" target=\"_blank\">Preview Variation</a>"}(),i=$("\n          <div class=\"row oooExperiment_variation\" variation_id=\""+e+"\">\n            <div class=\"col-sm-3\">\n              <h3>"+f+" "+h+"</h3>\n            </div>\n            <div class=\"col-sm-9\">\n              <pre class=\"col-sm-12\">"+(g?b.htmlspecialchars(g):"Empty Variant Code")+"</pre>\n            </div>\n          </div>\n        ");d.append(i).append("<hr>")}),d}},{key:"isExperiment",value:function isExperiment(a){return!!this.experiments[a]}},{key:"isVariation",value:function isVariation(a){return!!this.variations[a]}},{key:"htmlspecialchars",value:function htmlspecialchars(a){return a.replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}}],[{key:"stylesheet",value:function stylesheet(){return"<style id='opt_styles'>\n        #opt_backdrop {\n          position: fixed;\n          top: 0;\n          left: 0;\n          width: 100%;\n          height: 100%;\n          background: rgba(0, 0, 0, .4);\n          z-index: 99999998\n        }\n        #opt_container {\n          position: fixed;\n          overflow-y: auto;\n          background: #FFF;\n          padding: 20px;\n          left: 50%;\n          top: 50%;\n          border-radius: 4px;\n          box-shadow: 0 0 28px -1px black;\n          -webkit-box-shadow: 0 0 28px -1px black;\n          min-width: 300px;\n          min-height: 300px;\n          z-index: 99999999;\n        }\n        #account_stats>p {\n          width: 25%;\n          float: left;\n          text-align: center;\n          font-size: 20px;\n        }\n        .center {\n          text-align: center;\n        }\n        #opt_container code {\n          padding: 2px 4px;\n          font-size: 90%;\n          color: #c7254e;\n          background-color: #f9f2f4;\n          white-space: nowrap;\n          border-radius: 4px;\n        }\n        #opt_container .container {\n          width: 100% !important;\n        }\n        #opt_container b {\n          font-weight: bold !important;\n        }\n        #opt_container label {\n          display: inline-block;\n          margin: 5px;\n          padding: 5px;\n          border-radius: 3px;\n          color: black;\n        }\n        #opt_container .btn {\n          padding: 10px;\n          border-radius: 2px;\n          -webkit-border-radius: 2px;\n          cursor: pointer;\n          border: 1px solid transparent;\n        }\n        #opt_container .btn-info,\n        #opt_container .label-info {\n          background: #428bca;\n          border-color: #357ebd;\n        }\n        #opt_container .btn-info:hover,\n        #opt_container .label-info:hover {\n          background: #3276b1;\n          border-color: #285e8e;\n        }\n        #opt_container .btn-success,\n        #opt_container .label-success {\n          background: #5cb85c;\n          border-color: #4cae4c;\n        }\n        #opt_container .btn-success:hover,\n        #opt_container .label-success:hover {\n          background: #47a447;\n          border-color: #398439;\n        }\n        #opt_container .btn-warning,\n        #opt_container .label-warning {\n          background: #f0ad4e;\n          border-color: #eea236\n        }\n        #opt_container .btn-warning:hover,\n        #opt_container .label-warning:hover {\n          background: #ed9c28;\n          border-color: #d58512;\n        }\n        #opt_container .btn-danger,\n        #opt_container .label-danger {\n          background: #d9534f;\n          border-color#d43f3a;\n        }\n        #opt_container .btn-danger:hover,\n        #opt_container .label-danger:hover {\n          background: #d2322d;\n          border-color#ac2925;\n        }\n        #opt_container .btn-primary,\n        #opt_container .label-primary {\n          background: #428bca;\n          color: black !important;\n          border-color: #357ebd;\n        }\n        #opt_container .btn-primary:hover,\n        #opt_container .label-primary:hover {\n          background: #3276b1;\n          border-color#285e8e;\n        }\n        #opt_container pre {\n          width: 95%;\n          overflow: hidden;\n          word-wrap: break-word;\n        }\n        #opt_container .row {\n          width: 100%;\n          display: inline-block;\n          margin: 0;\n          padding: 5px;\n        }\n        #opt_container .well {\n          background-color: #f5f5f5;\n          padding: 10px;\n          border: 1px solid #e3e3e3;\n          box-shadow: inset 0 1px 1px rgba(0, 0, 0, .05);\n          -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, .05);\n        }\n        #opt_container .pull-right {\n          float: right\n        }\n        #opt_container .pull-left {\n          float: left;\n        }\n        #opt_container .closeme {\n          position: relative;\n          top: -7px;\n          right: -47%;\n          cursor: pointer;\n          font-size: 10px;\n          background: #FFF;\n          color: #35AFE3;\n          border-radius: 8px;\n          padding: 4px;\n        }\n        #opt_container .segment {\n          float:none\n        }\n      </style>"}}]),a}();window.esper=new Esper}