'use strict';(function(){function a(a){function b(b){var c=a.indexOf(b);a[c]&&a.splice(c,1)}function c(a){window.optly.ui.showCustomDialog({title:'Results',message:a})}a.map(function(a){return a.replace(/\s*[\[{(]primary[)}\]]\s*$/i,'')});var d=window.optly.page.experiment.projectId,e=window.optly.page.experiment.experimentId,f=window.optly.page.goalDialog.stateStack;a.length&&$.get('https://app.optimizely.com/api/project/'+d+'/goal.json?unaddable_included_experiment_id='+e,function(d){var f=[],h=(d.goals||{}).filter(function(a){return!(-1!==a.experiment_ids.indexOf(e))||(b(a.title),!1)}),j=[];for(var k in a){var l=void 0,m=a[k];for(var i in h){var n=h[i];if(n.title===m)if(!l)l=n;else{console.log('found duplicate of ',m),l=void 0;break}}l?(f.push(l),console.log('Found',m)):(j.push(m),console.log('Unable to find',m))}if(f.length){c('Adding these goals to the experiment:\n'+f.map(function(a){return a.title}).join(',\n')),console.log('Adding these goals to the experiment:',f);var g=function(){var a=f[i];$.post('https://app.optimizely.com/api/experiments/'+e+'/goal.json',{goal_id:a.goal_id},function(b){b.succeeded?console.log('Successfully added goal:',a.title):(c('API ERROR!'),console.warn('API error:',b))})};for(var i in f)g()}else c('No goals to be added.'),console.log('No goals to be added.');j.length&&(c('Unable to add these goals:\n'+j.join(',\n')),console.warn('Unable to add these goals:',j))})}var b={template:'\n    <div class="dialog--narrow lego-dialog">\n      <div class="lego-dialog__header">\n        <div class="lego-dialog__title">'+tr('[[ title ]]')+'</div>\n        </div> <div class="lego-dialog__body">\n          <p class="weight--bold" data-test-section="alert-dialog-message">'+tr('[[ description ]]')+'</p>\n          <textarea id="text" style="width: 100%; height: 200px; resize: vertical;"></textarea>\n        </div>\n        <div class="lego-dialog__footer lego-button-row--right">\n          <button type="button" class="lego-button lego-button--plain" v-hide-dialog="" data-test-section="confirm-cancel-button">'+tr('[[ cancelText ]]')+'</button>\n          <button type="submit" class="lego-button" data-test-section="confirm-submit-button" v-class="lego-button--danger: isWarning, lego-button--highlight: !isWarning" v-on="click: accept">'+tr('[[ confirmText ]]')+'</button>\n        </div>\n      </div>\n    </div>',methods:{accept:function accept(){var b=$(this.$el).find('#text').val().split('\n');a(b),this.$dispatch('hideDialog')}},defaultData:{title:'Quick-Add Goals',description:'Paste in goals (one per line) to be added to the experiment:',confirmText:'Accept',cancelText:'Cancel'}};window.optly.ui.showDialog({component:b})})();